# React Workflow Editor with ADFS Authentication & Intelligent OCR Integration

A modern React application featuring a workflow editor with integrated ADFS (Active Directory Federation Services) authentication and intelligent OCR (Optical Character Recognition) processing capabilities with automatic handwritten vs typed text classification.

## ğŸš€ Features

- **ğŸ” ADFS Authentication**: Secure login using OpenID Connect protocol
- **âš¡ Workflow Editor**: Interactive workflow builder with React Flow
- **ğŸ¤– Smart OCR Processing**: Automatic classification of handwritten vs typed text with intelligent routing
- **ğŸ“ Text Classification**: AI-powered analysis using Tesseract.js OCR confidence scoring
- **ğŸ“„ Dual OCR Endpoints**: Separate processing for handwritten and typed text optimization
- **ğŸ“ File Management**: Upload images, preview them, and process with appropriate OCR engine
- **ğŸ¨ Modern UI**: Clean, dark-themed interface with smooth animations and real-time status indicators
- **ğŸ”„ Hot Reload**: Development server with automatic page refresh
- **ğŸ“¦ TypeScript**: Full type safety throughout the application
- **ğŸ—ƒï¸ State Management**: MobX for reactive state management

## ğŸ› ï¸ Technology Stack

- **Frontend Framework**: [`React 18`](https://reactjs.org/) - Modern React with hooks
- **State Management**: [`MobX`](https://mobx.js.org/) - Reactive state management
- **Authentication**: [`oidc-client-ts`](https://github.com/authts/oidc-client-ts) - OpenID Connect client
- **Workflow Engine**: [`React Flow`](https://reactflow.dev/) - Interactive node-based editor
- **OCR Engine**: [`Tesseract.js`](https://tesseract.projectnaptha.com/) - JavaScript OCR library for text classification
- **Image Processing**: [`Sharp`](https://sharp.pixelplumbing.com/) - High-performance image processing
- **Build System**: [`esbuild`](https://esbuild.github.io/) - Fast JavaScript bundler
- **Backend**: [`Express.js`](https://expressjs.com/) - Web server framework
- **File Processing**: [`multer`](https://github.com/expressjs/multer) - Multipart form data handling
- **Language**: [`TypeScript`](https://www.typescriptlang.org/) - Type-safe JavaScript
- **Testing**: [`Jest`](https://jestjs.io/) - JavaScript testing framework

## ğŸ“ Project Structure

```
â”œâ”€â”€ src/                    # Backend server code
â”‚   â”œâ”€â”€ server.ts          # Main Express server
â”‚   â”œâ”€â”€ utils/             # Utility functions
â”‚   â”‚   â””â”€â”€ textClassification.ts # AI text classification logic
â”‚   â””â”€â”€ routes/            # API routes
â”‚       â””â”€â”€ workflowsRouter.ts # OCR API proxy endpoints & classification
â”œâ”€â”€ web/                   # Frontend React application
â”‚   â”œâ”€â”€ components/        # React components
â”‚   â”‚   â””â”€â”€ flow-renderer/ # Workflow editor components
â”‚   â”‚       â”œâ”€â”€ startNode.tsx         # Smart image upload & classification node
â”‚   â”‚       â”œâ”€â”€ ocrNode.tsx           # OCR processing node
â”‚   â”‚       â”œâ”€â”€ endNode.tsx           # Text download node
â”‚   â”‚       â””â”€â”€ ImagePreviewPopup.tsx # Image preview modal
â”‚   â”œâ”€â”€ stores/            # MobX state management
â”‚   â”‚   â”œâ”€â”€ OcrStore.ts    # OCR processing state with smart routing
â”‚   â”‚   â”œâ”€â”€ TextClassificationStore.ts # Text classification state
â”‚   â”‚   â””â”€â”€ GlobalsStore.ts # Root store
â”‚   â”œâ”€â”€ oidcConfig.ts     # ADFS authentication config
â”‚   â”œâ”€â”€ useOidcAuth.ts    # Authentication hook
â”‚   â””â”€â”€ App.tsx           # Main React component
â”œâ”€â”€ public/               # Static HTML files
â”œâ”€â”€ dev/                  # Development utilities
â””â”€â”€ dist/                 # Production build output
```

## ğŸ”§ Setup & Installation

### Prerequisites

- Node.js (v16 or higher)
- Access to ADFS server
- Valid ADFS application registration
- Docker backend with OCR services running:
  - `localhost:8000/ocr/typed` - Optimized for printed/typed text
  - `localhost:8000/ocr/handwritten` - Optimized for handwritten text

````

### Installation
```bash
# Install dependencies
npm install

# Start development server
npm run startDev
````

### Production Build

```bash
# Build for production
npm run build

# Start production server
npm start
```

## ğŸ” ADFS Configuration

### Required ADFS Setup

1. **Application Registration**: Register your app in ADFS Management Console
2. **Client ID**: Obtain from ADFS administrator
3. **Redirect URI**: Configure `http://localhost:5000/adfs1_sign`
4. **SSL Certificate**: Ensure ADFS has valid SSL certificate with proper key usage

### SSL Certificate Requirements

The ADFS server certificate must have:

- âœ… Digital Signature
- âœ… Key Encipherment
- âœ… Server Authentication (Extended Key Usage)

If experiencing SSL errors, generate a proper certificate:

```powershell
# Run on ADFS server as Administrator
$cert = New-SelfSignedCertificate `
    -DnsName "your-adfs-server.domain.com" `
    -CertStoreLocation "cert:\LocalMachine\My" `
    -KeyUsage DigitalSignature, KeyEncipherment `
    -KeyAlgorithm RSA -KeyLength 2048

Set-AdfsSslCertificate -Thumbprint $cert.Thumbprint
Restart-Service adfssrv
```

## ğŸš¦ Usage

### Authentication & Setup

1. **Start Application**: Run `npm run startDev`
2. **Access**: Open http://localhost:5000
3. **Login**: Click "Login with ADFS" to authenticate
4. **Token**: Click "Get Token" to retrieve access token for API calls

### Smart OCR Workflow

1. **Upload Image**: Click the upload button in the Start node to select an image
2. **Preview**: Click on the uploaded file to preview the image in a centered popup
3. **Auto-Classification**: System automatically analyzes the image to determine if text is handwritten or typed
4. **Smart Processing**: Click the play button to start OCR processing with the appropriate engine:
   - ğŸ–¨ï¸ **Typed text** â†’ Routes to `/ocr/typed` endpoint (optimized for printed text)
   - âœï¸ **Handwritten text** â†’ Routes to `/ocr/handwritten` endpoint (optimized for handwriting)
5. **Review**: View extracted text in the OCR node (editable)
6. **Download**: Use the End node to download extracted text as .txt file

### Intelligent Features

- **AI Text Classification**: Uses Tesseract.js OCR confidence analysis to determine text type
- **Smart Routing**: Automatically selects the best OCR endpoint based on classification
- **Visual Indicators**: Shows classification results with icons (ğŸ–¨ï¸ typed, âœï¸ handwritten)
- **Error Handling**: Robust fallback mechanisms for classification failures

### Workflow Nodes

- **Start Node**: Smart image upload with automatic text classification and processing initiation
- **OCR Node**: Text extraction display with dark theme
- **End Node**: Download extracted text functionality

````

## ğŸ“œ Available Scripts

- `npm run startDev` - Start development server with hot reload
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm test` - Run test suite
- `npm run check` - Run type checking

## ğŸ”Œ API Endpoints

### OCR Processing
- `POST /api/workflows/ocr/typed` - Process image optimized for typed/printed text
  - Accepts: `multipart/form-data` with image file
  - Proxies to: `localhost:8000/ocr/typed`
  - Returns: JSON with extracted text and confidence score

- `POST /api/workflows/ocr/handwritten` - Process image optimized for handwritten text
  - Accepts: `multipart/form-data` with image file
  - Proxies to: `localhost:8000/ocr/handwritten`
  - Returns: JSON with array of text lines

### Text Classification
- `POST /api/workflows/text-classification` - Analyze image to classify text type
  - Accepts: `multipart/form-data` with image file
  - Uses: Local Tesseract.js OCR analysis
  - Returns: JSON with classification result
  ```json
  {
    "classification": "handwritten" | "typed",
    "confidence": 85,
    "justification": "high OCR confidence indicates printed text"
  }
````

## ğŸ¨ UI Features

### Visual Design

- **Dark Theme**: Modern dark interface with proper contrast
- **Smart Indicators**: Real-time classification badges with icons (ğŸ–¨ï¸ typed, âœï¸ handwritten)
- **Animations**: Smooth transitions and loading states
- **Responsive**: Works across different screen sizes
- **Interactive**: Real-time feedback and status indicators
- **Text Overflow**: Smart text truncation with ellipsis for long filenames

### File Handling

- **Single Upload**: One image file at a time with automatic classification
- **Format Support**: Common image formats (PNG, JPG, GIF, etc.)
- **Smart Processing**: Automatic routing to appropriate OCR endpoint
- **Download**: Export extracted text as timestamped .txt files
- **Preview**: Visual feedback for uploaded files with click-to-preview functionality

### ADFS Settings

Configure in `web/oidcConfig.ts`:

- Authority: Your ADFS server URL
- Client ID: Application ID from ADFS
- Redirect URI: Authentication callback URL

```

```


## Testing Changes

This is a test modification to verify that gith status correctly detects changes.
The file has been modified locally and should show as modified in gith status.

